<pre>/////////////////////////////////////////////////////////////
// PlugInDataFlowStructure::Compute::lib.rs                //
//   - Attempts to read opened file to string, count lines //
// Jim Fawcett, https://JimFawcett.github.io, 04 Mar 2021  //
/////////////////////////////////////////////////////////////
/* 
  Note:
    - creates instance of Output
    - attempts to read file to string and count its lines
    - sends results to Output
*/
use input::{Compute};
use std::fs::*;

/*---------------------------------------------------------
  PlugIns require use of Trait Objects
-----------------------------------------------------------
  Trait objects cannot:
    - have functions that return Self
    - have generic functions
*/
pub trait Output {
    // fn new() -&gt; Self;
    fn do_output(&amp;self, name: &amp;str, lines: usize);
}

mod file_utilities;
use file_utilities::read_file_to_string;

pub struct ComputeImpl {
  lines: usize,
  out: Option&lt;Box&lt;dyn Output&gt;&gt;  // will hold trait object
}
impl Compute for ComputeImpl {
    fn new() -&gt; ComputeImpl {
        ComputeImpl {
            lines: 0,
            out: None
        }
    }
    fn do_compute(&amp;mut self, name: &amp;str, mut file:File) {
        let rslt = read_file_to_string(&amp;mut file);
        if let Ok(contents) = rslt {
            self.lines = 1;
            for ch in contents.chars() {
                if ch == '\n' {
                    self.lines += 1;
                }
            }
            if let Some(plug) = &amp;self.out {
                plug.do_output(name, self.lines);
            }
        }
        else {
            print!("\n  could not read {:?}", name);
        }
    }
    fn lines(&amp;self) -&gt; usize {
        self.lines
    }
}
impl ComputeImpl {
    pub fn set_output(&amp;mut self, out: Box&lt;dyn Output&gt;) {
        &amp;self.out.replace(out);
    }
}
#[cfg(test)]
mod tests {
    #[test]
    fn it_works() {
        assert_eq!(2 + 2, 4);
    }
}
</pre>